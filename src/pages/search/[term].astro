---
import Layout from "@/layouts/default.astro";
import SearchResult from "@/components/pages/search/SearchResult";
import { search as searchByOrthology } from "@/utils/services/geneService";
import { search as searchByPhenotypes } from "@/utils/services/phenotypeService";

export const prerender = false;

const { term = "" } = Astro.params;

const penetrance = 0.8;
const itemsPerPage = 10;

const orthologyData = await searchByOrthology(term);
const phenotypeData = await searchByPhenotypes(
  term,
  penetrance,
  0,
  itemsPerPage,
);

if (orthologyData?.genes && orthologyData.genes.length > 0) {
  return Astro.redirect(`/details/${orthologyData.genes[0]}`);
}
---

<Layout>
  <div class="max-w-7xl mx-auto flex flex-col gap-8">
    <div class="flex flex-col gap-8 animate-in fade-in duration-500">
      <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
        <div>
          <p class="text-sm font-medium text-slate-500 mb-1">
            Search results for:
          </p>
          <h1 class="text-3xl font-display font-bold text-slate-900">
            {term}
          </h1>
        </div>
      </div>
      <SearchResult
        term={term}
        orthologyData={orthologyData}
        phenotypeData={phenotypeData}
        client:load
      />
    </div>
  </div>
</Layout>
